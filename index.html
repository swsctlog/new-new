<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Голосовой Ассистент</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

        .status {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>

<body>
    <div class="container text-center">
        <h1 class="mb-4">Голосовой Ассистент</h1>
        <p class="status" id="status">Подключение...</p>
        <div class="alert alert-info mt-4" id="output">
            Ожидаю команду...
        </div>
        <div class="mt-5">
            <button class="btn btn-primary" id="startButton">Запустить распознавание</button>
            <button class="btn btn-danger" id="stopButton">Остановить распознавание</button>
        </div>
        <div class="mt-4">
            <input type="text" class="form-control w-50 d-inline-block" id="textInput" placeholder="Введите текст">
            <button class="btn btn-success" id="submitButton">Отправить</button>
        </div>
    </div>

    <script>
        if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
            alert('Ваш браузер не поддерживает SpeechRecognition. Попробуйте Google Chrome.');
        } else {
            const keywords = {
                'ютуб': 'Открываю YouTube, сэр.',
                'google': 'Открываю Google, сэр.',
                'rutube': 'Открываю Rutube, сэр.',
                'bloomberg': 'Открываю Bloomberg, сэр.',
                'инвестиционные новости': 'Открываю Invest.com, сэр.',
                'феликс': ['Да, сэр?', 'Я вас слушаю, сэр.', 'Что вам нужно, сэр?'],
                'спасибо': ['Всегда пожалуйста, сэр.', 'Я рад, что смог помочь, сэр.'],
                'молодец': 'Я рад, что помог, сэр!'
            };

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'ru-RU';
            recognition.interimResults = false;
            recognition.continuous = true;

            const statusElement = document.getElementById('status');
            const outputElement = document.getElementById('output');
            const startButton = document.getElementById('startButton');
            const stopButton = document.getElementById('stopButton');
            const textInput = document.getElementById('textInput');
            const submitButton = document.getElementById('submitButton');

            let isListening = false;

            function speak(text) {
                const synth = window.speechSynthesis;
                const utterance = new SpeechSynthesisUtterance(text);

                utterance.lang = 'ru-RU';
                utterance.rate = 0.9;
                utterance.pitch = 0.8;
                utterance.volume = 1;

                const voices = synth.getVoices();
                const preferredVoice = voices.find(voice =>
                    voice.lang === 'ru-RU' && (voice.name.includes('Google') || voice.name.includes('Microsoft'))
                );

                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                synth.speak(utterance);
            }

            function debounce(func, delay) {
                let timer;
                return function (...args) {
                    clearTimeout(timer);
                    timer = setTimeout(() => func.apply(this, args), delay);
                };
            }

            const processText = debounce((text) => {
                text = text.toLowerCase();
                for (let keyword in keywords) {
                    if (text.includes(keyword)) {
                        const response = Array.isArray(keywords[keyword])
                            ? keywords[keyword][Math.floor(Math.random() * keywords[keyword].length)]
                            : keywords[keyword];

                        outputElement.textContent = `Ключевое слово: ${keyword}`;
                        speak(response);

                        if (keyword === 'ютуб') window.open('https://www.youtube.com', '_blank');
                        if (keyword === 'google') window.open('https://www.google.com', '_blank');
                        if (keyword === 'rutube') window.open('https://www.rutube.ru', '_blank');
                        if (keyword === 'bloomberg') window.open('https://www.bloomberg.com', '_blank');
                        if (keyword === 'инвестиционные новости') window.open('https://www.investing.com', '_blank');
                        return;
                    }
                }
            }, 300);

            recognition.onresult = (event) => {
                const transcript = event.results[event.results.length - 1][0].transcript.trim();
                outputElement.textContent = `Распознанный текст: ${transcript}`;
                processText(transcript);
            };

            recognition.onerror = (event) => {
                console.error(`Ошибка распознавания: ${event.error}`);
                if (isListening) recognition.start();
            };

            recognition.onend = () => {
                if (isListening) recognition.start();
            };

            startButton.addEventListener('click', () => {
                recognition.start();
                isListening = true;
                statusElement.textContent = 'Слушаю...';
                statusElement.style.color = '#007bff';
            });

            stopButton.addEventListener('click', () => {
                recognition.stop();
                isListening = false;
                statusElement.textContent = 'Распознавание остановлено.';
                statusElement.style.color = 'red';
            });

            submitButton.addEventListener('click', () => {
                const text = textInput.value.trim();
                if (text) processText(text);
                else alert('Введите текст перед отправкой!');
            });
        }
    </script>
</body>

</html>
